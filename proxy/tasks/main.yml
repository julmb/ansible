- name: docker package
  ansible.builtin.apt: { pkg: [docker.io, docker-compose] }
- name: docker compose definition
  ansible.builtin.template: { src: docker-compose.yml, dest: "{{ path }}/" }
- name: certbot docker container
  ansible.builtin.copy: { src: certbot, dest: "{{ path }}/" }
- name: docker compose up
  community.docker.docker_compose: { project_src: "{{ path }}" }

- name: default configuration
  ansible.builtin.copy: { src: default.conf, dest: "{{ path }}/configuration/" }
  # TODO: restart nginx only
  notify: restart proxy containers
- name: flush handlers
  ansible.builtin.meta: flush_handlers
- name: certificates
  ansible.builtin.include_tasks: certificate.yml
  loop: "{{ entries | dict2items }}"
