{% if dnsmasq.address is defined %}
listen-address = {{ dnsmasq.address }}
{% endif %}
{% if dnsmasq.domain is defined %}
domain = {{ dnsmasq.domain }}
expand-hosts
{% endif %}
{% if dnsmasq.cache is defined %}
cache-size = {{ dnsmasq.cache }}
{% endif %}

{% if dnsmasq.dhcp is defined %}
dhcp-range = {{ dnsmasq.dhcp.start }}, {{ dnsmasq.dhcp.end }}{{ ', ' + dnsmasq.dhcp.duration if dnsmasq.dhcp.duration is defined }}
{% if dnsmasq.dhcp.gateway is defined %}
dhcp-option = option:router, {{ dnsmasq.dhcp.gateway }}
{% endif %}
{% if dnsmasq.dhcp.nameserver is defined %}
dhcp-option = option:dns-server, {{ dnsmasq.dhcp.nameserver }}
{% endif %}
{% if dnsmasq.hosts is defined %}
{% for host, entry in dnsmasq.hosts.items() %}
dhcp-host = {{ host }}{{ ', ' + entry.mac }}{{ ', ' + entry.ip if entry.ip is defined }}
{% endfor %}
{% endif %}
{% endif %}

{% if dnsmasq.nameservers is defined %}
no-resolv
{% for nameserver in dnsmasq.nameservers %}
server = {{ nameserver }}
{% endfor %}
{% endif %}

no-hosts
addn-hosts = /etc/dnsmasq.hosts

{% if dnsmasq.aliases is defined %}
{% for alias, target in dnsmasq.aliases.items() %}
cname = {{ alias }}, {{ target }}
{% endfor %}
{% endif %}
