#!/bin/bash

# Append the output of smartctl -a to the message:
#/usr/sbin/smartctl -a -d $SMART_DEVICETYPE $SMARTD_DEVICE >> /root/msg

export time=$(date -Iseconds -d @$SMARTD_TFIRSTEPOCH)

# TODO: check more variables exposed by smartd
header="Content-Type: application/json"
data=$(envsubst <<< '{{ template | to_json }}')
data=${data//$'\n'/\\n}

echo "$data"

curl --silent --header "$header" --data "$data" {{ url }}
