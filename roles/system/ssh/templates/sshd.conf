{% if system.configuration.address is defined %}
ListenAddress {{ system.configuration.address }}
{% endif %}
{% if system.configuration.port is defined %}
Port {{ system.configuration.port }}
{% endif %}

{% if system.configuration.password is defined %}
PasswordAuthentication {{ "yes" if system.configuration.password else "no" }}
{% endif %}

{% if system.configuration.share is defined %}
# the default debian sshd_config has `Subsystem sftp /usr/lib/openssh/sftp-server`
# sftp clients request this subsystem and sshd runs the sftp-server executable
# however, this executable is not availble in the chroot environment
# so we use ForceCommand to override it to use the internal-sftp server
# the subsystem directive is still required, else the client's request will be denied
Match Group share
	DisableForwarding yes
	ForceCommand internal-sftp
	ChrootDirectory {{ system.configuration.share }}
{% endif %}
