<domain type="{{ domain.value.type }}">
  <name>{{ domain.key }}</name>
  <uuid>{{ domain.key | to_uuid }}</uuid>
  <vcpu>{{ domain.value.cpus }}</vcpu>
  <memory unit="bytes">{{ domain.value.memory }}</memory>
  <os>
    <type arch="{{ domain.value.architecture }}" machine="{{ domain.value.chipset }}">hvm</type>
    <loader type="pflash" readonly="yes">/usr/share/OVMF/OVMF_CODE_4M.fd</loader>
  </os>
  <features>
    <acpi/>
  </features>
  <cpu mode="host-passthrough" />
  <devices>
    <emulator>/usr/bin/qemu-system-x86_64</emulator>
{% for entry in domain.value.storage %}
    <disk type="{{ entry.meta.type }}" device="{{ entry.meta.kind }}">
{% if entry.meta.type == 'volume' %}
      <source pool="{{ entry.volume.pool }}" volume="{{ entry.volume.name }}"/>
{% elif entry.meta.type == 'file' %}
      <source file="{{ entry.path }}"/>
{% endif %}
      <target dev="{{ entry.meta.device }}" bus="{{ entry.meta.bus }}"/>
      <boot order="{{ entry.meta.boot }}"/>
    </disk>
{% endfor %}
    <interface type="network">
      <mac address="52:54:00:8e:d6:bb"/>
      <model type="virtio"/>
      <source network="default"/>
    </interface>
    <graphics type="spice" autoport="yes" />
    <video>
      <model type="virtio" />
    </video>
  </devices>
</domain>
