- name: "{{ domain.key }} volumes"
  ansible.builtin.include_tasks: volume.yml
  vars: { content: "{{ storage.content }}" }
  loop: "{{ domain.value.storage }}"
  loop_control: { loop_var: storage }
  when: storage.meta.type == 'volume'
# TODO: this successfully updates configuration but does not error on uuid mismatch
#       it also reports config changed, how does it do that? is domain define different from pool define?
# TODO: config always changes due to autogenerated mac address
- name: domain
  community.libvirt.virt: { command: define, xml: "{{ lookup('template', 'domain.xml') }}" }
