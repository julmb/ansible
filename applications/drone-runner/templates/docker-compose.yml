version: "3"

services:
  main:
    image: drone/drone-runner-docker
    restart: unless-stopped
    volumes: [/var/run/docker.sock:/var/run/docker.sock]
    ports:
    - {{ '{}:3000:3000'.format(address) if address is defined else '3000:3000' }}
    environment:
      DRONE_RUNNER_NAME: {{ name }}
      DRONE_RUNNER_CAPACITY: {{ capacity }}
      DRONE_RPC_PROTO: http
      DRONE_RPC_HOST: {{ url }}
      DRONE_RPC_SECRET: {{ secret }}
