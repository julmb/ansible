<domain type="{{ domain.value.type }}">

  <name>{{ domain.key }}</name>
  <uuid>{{ domain.key | to_uuid }}</uuid>

  <os>
    <type arch="{{ domain.value.platform.architecture | default }}"
      machine="{{ domain.value.platform.chipset | default }}">hvm</type>
{% if domain.value.platform.uefi | default(false) %}
    <loader type="pflash" readonly="yes">/usr/share/OVMF/OVMF_CODE_4M.fd</loader>
{% endif %}
  </os>
  <features><acpi/></features>

  <cpu mode="host-passthrough"/>
  <vcpu>{{ domain.value.hardware.cpus }}</vcpu>
  <memory unit="bytes">{{ domain.value.hardware.memory }}</memory>

  <devices>

{% for entry in domain.value.storage %}
    <disk type="{{ entry.type }}" device="{{ entry.device.type }}">
{% if entry.type == 'volume' %}
      <source pool="{{ entry.volume.pool }}" volume="{{ entry.volume.name }}"/>
{% elif entry.type == 'file' %}
      <source file="{{ entry.path }}"/>
{% endif %}
      <target dev="{{ entry.device.name }}" bus="{{ entry.device.bus }}"/>
      <boot order="{{ entry.device.boot }}"/>
    </disk>
{% endfor %}

    <interface type="network">
      <mac address="52:54:00:8e:d6:bb"/>
      <model type="virtio"/>
      <source network="default"/>
    </interface>

    <graphics type="spice" autoport="yes" />
    <video>
      <model type="virtio" />
    </video>

  </devices>

</domain>
