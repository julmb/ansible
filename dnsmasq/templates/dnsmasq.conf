{% if address is defined %}
listen-address = {{ address }}
{% endif %}
{% if domain is defined %}
domain = {{ domain }}
expand-hosts
{% endif %}
{% if cache is defined %}
cache-size = {{ cache }}
{% endif %}

{% if dhcp is defined %}
dhcp-range = {{ dhcp.start }}, {{ dhcp.end }}{{ ', ' + dhcp.duration if dhcp.duration is defined }}
{% if dhcp.gateway is defined %}
dhcp-option = option:router, {{ dhcp.gateway }}
{% endif %}
{% if dhcp.nameserver is defined %}
dhcp-option = option:dns-server, {{ dhcp.nameserver }}
{% endif %}
{% if hosts is defined %}
{% for host, entry in hosts.items() %}
dhcp-host = {{ host }}{{ ', ' + entry.mac }}{{ ', ' + entry.ip if entry.ip is defined }}
{% endfor %}
{% endif %}
{% endif %}

{% if nameservers is defined %}
no-resolv
{% for nameserver in nameservers %}
server = {{ nameserver }}
{% endfor %}
{% endif %}

{% if hosts is defined or domains is defined %}
no-hosts
addn-hosts = /etc/dnsmasq.hosts
{% endif %}

{% if aliases is defined %}
{% for alias, target in aliases.items() %}
cname = {{ alias }}, {{ target }}
{% endfor %}
{% endif %}
