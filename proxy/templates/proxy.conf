# TODO: reuse default.conf that ships with nginx image
server
{
	location / { root /usr/share/nginx/html; }
}

{% if proxy is defined %}
{% for name, target in proxy.items() %}
server
{
	listen 443 ssl;
	server_name {{ name }};
    ssl_certificate /etc/letsencrypt/live/{{ name }}/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/{{ name }}/privkey.pem;
	location / { proxy_pass http://{{ target }}; }
}
{% endfor %}
{% endif %}
